import{r as d,m as y,o as $,G as g,c as i,a as t,f as x,e as u,t as o,k as N,L as U,F as Y,g as j,h as l,n as C}from"./index-CanbGPVk.js";import{d as p}from"./DataService-z2Ih9ngB.js";import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";const T={class:"container py-4 py-lg-5"},z={class:"row"},G={class:"col-12"},H={class:"d-flex justify-content-between align-items-center mb-4"},J={class:"d-flex gap-2"},W=["disabled"],q={key:0,class:"spinner-border spinner-border-sm me-2"},K={key:1,class:"bi bi-check-all me-2"},O=["disabled"],Q={key:0,class:"spinner-border spinner-border-sm me-2"},X={key:1,class:"bi bi-arrow-clockwise me-2"},Z={class:"row g-3 mb-4"},I={class:"col-md-4"},ee={class:"card bg-primary text-white"},te={class:"card-body text-center"},se={class:"card-title"},ae={class:"col-md-4"},ie={class:"card bg-warning text-dark"},le={class:"card-body text-center"},ne={class:"card-title"},oe={class:"col-md-4"},re={class:"card bg-success text-white"},de={class:"card-body text-center"},ce={class:"card-title"},ue={key:0,class:"text-center py-5"},be={key:1,class:"alert alert-danger",role:"alert"},ve={key:2,class:"text-center py-5"},fe={key:3,class:"card"},me={class:"card-header bg-light"},_e={class:"d-flex justify-content-between align-items-center"},ge={class:"d-flex gap-2"},pe={class:"btn-group btn-group-sm",role:"group"},ye={class:"card-body p-0"},he={class:"list-group list-group-flush"},ke={class:"d-flex w-100 justify-content-between align-items-start"},we={class:"flex-grow-1"},xe={class:"d-flex align-items-center mb-2"},Ne={key:0,class:"badge bg-warning text-dark ms-2"},Ue={class:"mb-2 text-muted"},Ce={class:"text-muted"},Me={class:"ms-3 d-flex flex-column gap-2"},Ae=["onClick","disabled"],Re={key:0,class:"spinner-border spinner-border-sm me-1"},De={key:1,class:"bi bi-check me-1"},Ee=["onClick","disabled"],Le={key:0,class:"spinner-border spinner-border-sm me-1"},Fe={key:1,class:"bi bi-trash me-1"},Se={key:4,class:"text-center mt-4"},Ve=20,Pe={__name:"NotificationPage",setup($e){const n=d([]),b=d(!1),r=d(null),v=d("all"),h=d(!1),k=d(1),f=d([]),m=d([]),_=d(!1),M=y(()=>n.value.filter(s=>!s.read).length),R=y(()=>n.value.filter(s=>s.read).length),D=y(()=>M.value>0),E=y(()=>{switch(v.value){case"unread":return n.value.filter(s=>!s.read);case"read":return n.value.filter(s=>s.read);default:return n.value}});$(async()=>{await w()});async function w(){try{b.value=!0,r.value=null;const s=await g.getCurrentUser();if(!s.user){r.value="You must be logged in to view notifications.";return}const e=await p.getUserNotifications(s.user.email);n.value=e.notifications||[],h.value=e.hasMore||!1,k.value=1,console.log(`Loaded ${n.value.length} notifications`)}catch(s){console.error("Error loading notifications:",s),r.value="Failed to load notifications. Please try again."}finally{b.value=!1}}async function L(){try{const s=await g.getCurrentUser();if(!s.user)return;const e=k.value+1,a=await p.getUserNotifications(s.user.email,e,Ve);n.value.push(...a.notifications||[]),h.value=a.hasMore||!1,k.value=e}catch(s){console.error("Error loading more notifications:",s),r.value="Failed to load more notifications."}}async function F(s){try{f.value.push(s);const e=await g.getCurrentUser();if(!e.user)return;await p.markNotificationAsRead(s,e.user.email);const a=n.value.find(c=>c.notification_id===s);a&&(a.read=!0)}catch(e){console.error("Error marking notification as read:",e),r.value="Failed to mark notification as read."}finally{f.value=f.value.filter(e=>e!==s)}}async function S(){try{_.value=!0;const s=await g.getCurrentUser();if(!s.user)return;await p.markAllNotificationsAsRead(s.user.email),n.value.forEach(e=>{e.read=!0})}catch(s){console.error("Error marking all notifications as read:",s),r.value="Failed to mark all notifications as read."}finally{_.value=!1}}async function V(s){if(confirm("Are you sure you want to delete this notification?"))try{m.value.push(s);const e=await g.getCurrentUser();if(!e.user)return;await p.deleteNotification(s,e.user.email),n.value=n.value.filter(a=>a.notification_id!==s)}catch(e){console.error("Error deleting notification:",e),r.value="Failed to delete notification."}finally{m.value=m.value.filter(e=>e!==s)}}function P(s){if(!s)return"Unknown date";try{let e;s.seconds?e=new Date(s.seconds*1e3):e=new Date(s);const a=new Date,c=(a-e)/(1e3*60*60);if(c<1){const A=Math.floor((a-e)/6e4);return A<=1?"Just now":`${A} minutes ago`}else return c<24?`${Math.floor(c)} hours ago`:c<48?"Yesterday":e.toLocaleDateString()}catch(e){return console.error("Error formatting date:",e),"Unknown date"}}return(s,e)=>(l(),i("div",T,[t("div",z,[t("div",G,[t("div",H,[e[3]||(e[3]=t("div",null,[t("h1",{class:"h3 mb-1"},"Notifications"),t("p",{class:"text-muted mb-0"},"Stay updated with your program activities")],-1)),t("div",J,[t("button",{onClick:S,class:"btn btn-outline-primary btn-sm",disabled:!D.value||_.value},[_.value?(l(),i("span",q)):(l(),i("i",K)),u(" "+o(_.value?"Marking...":"Mark All Read"),1)],8,W),t("button",{onClick:w,class:"btn btn-outline-secondary btn-sm",disabled:b.value},[b.value?(l(),i("span",Q)):(l(),i("i",X)),u(" "+o(b.value?"Loading...":"Refresh"),1)],8,O)])]),t("div",Z,[t("div",I,[t("div",ee,[t("div",te,[e[4]||(e[4]=t("i",{class:"bi bi-bell display-6 mb-2"},null,-1)),t("h5",se,o(n.value.length),1),e[5]||(e[5]=t("p",{class:"card-text small mb-0"},"Total Notifications",-1))])])]),t("div",ae,[t("div",ie,[t("div",le,[e[6]||(e[6]=t("i",{class:"bi bi-bell-fill display-6 mb-2"},null,-1)),t("h5",ne,o(M.value),1),e[7]||(e[7]=t("p",{class:"card-text small mb-0"},"Unread",-1))])])]),t("div",oe,[t("div",re,[t("div",de,[e[8]||(e[8]=t("i",{class:"bi bi-check-circle display-6 mb-2"},null,-1)),t("h5",ce,o(R.value),1),e[9]||(e[9]=t("p",{class:"card-text small mb-0"},"Read",-1))])])])]),b.value&&n.value.length===0?(l(),i("div",ue,[...e[10]||(e[10]=[t("div",{class:"spinner-border text-primary mb-3",role:"status"},[t("span",{class:"visually-hidden"},"Loading notifications...")],-1),t("p",{class:"text-muted"},"Loading your notifications...",-1)])])):r.value?(l(),i("div",be,[e[11]||(e[11]=t("i",{class:"bi bi-exclamation-triangle me-2"},null,-1)),u(" "+o(r.value)+" ",1),t("button",{onClick:w,class:"btn btn-outline-danger btn-sm ms-2"}," Try Again ")])):n.value.length===0?(l(),i("div",ve,[...e[12]||(e[12]=[t("i",{class:"bi bi-bell-slash display-1 text-muted mb-4"},null,-1),t("h4",{class:"mb-3"},"No Notifications",-1),t("p",{class:"text-muted mb-4"}," You don't have any notifications yet. When programs are updated or cancelled, you'll see them here. ",-1)])])):(l(),i("div",fe,[t("div",me,[t("div",_e,[e[16]||(e[16]=t("h5",{class:"card-title mb-0"},[t("i",{class:"bi bi-list-ul me-2"}),u(" Your Notifications ")],-1)),t("div",ge,[t("div",pe,[N(t("input",{type:"radio",class:"btn-check",name:"filter",id:"filter-all","onUpdate:modelValue":e[0]||(e[0]=a=>v.value=a),value:"all"},null,512),[[U,v.value]]),e[13]||(e[13]=t("label",{class:"btn btn-outline-secondary",for:"filter-all"},"All",-1)),N(t("input",{type:"radio",class:"btn-check",name:"filter",id:"filter-unread","onUpdate:modelValue":e[1]||(e[1]=a=>v.value=a),value:"unread"},null,512),[[U,v.value]]),e[14]||(e[14]=t("label",{class:"btn btn-outline-warning",for:"filter-unread"},"Unread",-1)),N(t("input",{type:"radio",class:"btn-check",name:"filter",id:"filter-read","onUpdate:modelValue":e[2]||(e[2]=a=>v.value=a),value:"read"},null,512),[[U,v.value]]),e[15]||(e[15]=t("label",{class:"btn btn-outline-success",for:"filter-read"},"Read",-1))])])])]),t("div",ye,[t("div",he,[(l(!0),i(Y,null,j(E.value,a=>(l(),i("div",{key:a.notification_id,class:C(["list-group-item list-group-item-action",{"list-group-item-warning":!a.read,"border-start border-warning border-3":!a.read}])},[t("div",ke,[t("div",we,[t("div",xe,[t("i",{class:C(["bi me-2",a.read?"bi-envelope-open text-muted":"bi-envelope-fill text-warning"])},null,2),t("h6",{class:C(["mb-0",{"fw-bold":!a.read}])},o(a.notification_title),3),a.read?x("",!0):(l(),i("span",Ne,"New"))]),t("p",Ue,o(a.notification_text),1),t("small",Ce,[e[17]||(e[17]=t("i",{class:"bi bi-clock me-1"},null,-1)),u(" "+o(P(a.createdAt)),1)])]),t("div",Me,[a.read?x("",!0):(l(),i("button",{key:0,onClick:c=>F(a.notification_id),class:"btn btn-outline-success btn-sm",disabled:f.value.includes(a.notification_id)},[f.value.includes(a.notification_id)?(l(),i("span",Re)):(l(),i("i",De)),u(" "+o(f.value.includes(a.notification_id)?"Marking...":"Mark Read"),1)],8,Ae)),t("button",{onClick:c=>V(a.notification_id),class:"btn btn-outline-danger btn-sm",disabled:m.value.includes(a.notification_id)},[m.value.includes(a.notification_id)?(l(),i("span",Le)):(l(),i("i",Fe)),u(" "+o(m.value.includes(a.notification_id)?"Deleting...":"Delete"),1)],8,Ee)])])],2))),128))])])])),h.value&&!b.value?(l(),i("div",Se,[t("button",{onClick:L,class:"btn btn-outline-primary"},[...e[18]||(e[18]=[t("i",{class:"bi bi-arrow-down-circle me-2"},null,-1),u(" Load More Notifications ",-1)])])])):x("",!0)])])]))}},Te=B(Pe,[["__scopeId","data-v-9699c05e"]]);export{Te as default};
